# 魂診断スプレッドシート自動記入Webhook API仕様

## 概要
このWebhookは、外部からPOSTされたデータを元に、指定されたGoogleスプレッドシートの特定シートと行に魂診断の結晶項目を自動記入するためのものです。

## エンドポイント
`POST /webhook/soul-diagnosis`

## リクエスト仕様

### ヘッダー
- `Content-Type: application/json`

### リクエストボディ（JSON）
```json
{
  "week": "Week1_自分史",  // 必須: 書き込み先シート名
  "row": 3,               // 必須: 書き込み先行番号（整数）
  "意味": "テキスト内容",     // 任意: 「意味」列に書き込む内容
  "価値観・信念": "テキスト内容", // 任意: 「価値観・信念」列に書き込む内容
  "現在への影響": "テキスト内容", // 任意: 「現在への影響」列に書き込む内容
  "誇り": "テキスト内容",     // 任意: 「誇り」列に書き込む内容
  "再統合メッセージ": "テキスト内容", // 任意: 「再統合メッセージ」列に書き込む内容
  "未完了テーマ": "テキスト内容",  // 任意: 「未完了テーマ」列に書き込む内容
  "最後の気づき（自由記述）": "テキスト内容" // 任意: 「最後の気づき（自由記述）」列に書き込む内容
}
```

### 必須パラメータ
- `week`: 書き込み先シート名（文字列）
- `row`: 書き込み先行番号（整数）

### 任意パラメータ
以下のパラメータは任意です。含まれている場合のみ対応する列に書き込みます。
- `意味`
- `価値観・信念`
- `現在への影響`
- `誇り`
- `再統合メッセージ`
- `未完了テーマ`
- `最後の気づき（自由記述）`

## レスポンス仕様

### 成功時（200 OK）
```json
{
  "status": "success",
  "message": "データを正常に書き込みました",
  "details": {
    "sheet": "Week1_自分史",
    "row": 3,
    "columns_updated": ["意味", "価値観・信念"]  // 実際に更新された列名のリスト
  }
}
```

### エラー時（4xx/5xx）
```json
{
  "status": "error",
  "message": "エラーメッセージ",
  "error_code": "ERROR_CODE"
}
```

#### 主なエラーコード
- `INVALID_REQUEST`: リクエスト形式が不正
- `MISSING_REQUIRED_PARAMS`: 必須パラメータ不足
- `SHEET_NOT_FOUND`: 指定されたシートが見つからない
- `ROW_OUT_OF_RANGE`: 指定された行が範囲外
- `AUTH_ERROR`: 認証エラー
- `SPREADSHEET_ERROR`: スプレッドシート操作エラー
- `INTERNAL_ERROR`: 内部サーバーエラー

## 認証・セキュリティ
- Googleスプレッドシートへのアクセスはサービスアカウントを使用
- サービスアカウントの認証情報（JSONファイル）は環境変数または設定ファイルで安全に管理
- 対象のスプレッドシートはサービスアカウントと共有されている必要あり

## 注意事項
- 既存のセル内容は上書きされます
- 送信されなかった項目は更新されません（空欄にはなりません）
- 「最後の気づき（自由記述）」はPOSTで送られてきた場合のみ記入されます
